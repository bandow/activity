<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<meta name="author" content="name, sycbbb@sina.com"/>
<meta name="robots" content="index,follow"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
<meta name="format-detection" content="telephone=no, email=no,adress=no"/>
<meta name="msapplication-tap-highlight" content="no">
<link rel="stylesheet" href="styles/chooseCoupons.css">
</head>
<body>
<div class="wrapper choose-coupons-wrapper">
	<header class="choose-coupons-header" style="background:url(images/header_bg.jpg) no-repeat; background-size:100% 100%;">
		<a class="left dossen-header-left" href="javascript:goback();"></a>
		<h1>选择优惠券</h1>
		<div class="right">
			<a class="nonuse-coupon" href="javascript:;">不使用优惠券</a>
		</div>
	</header>
	<div class="choose-coupos-content">
		<div class="date-list">
			<ul></ul>
		</div>
		<div class="coupon-list"></div>
	</div>
	<footer class="choose-coupons-footer" ref="footerHeight">
		<p class="clickPrompt"><span>温馨提示：为什么不能再选择优惠了</span><i><img src="images/question_mark.png" alt=""></i></p>
		<div class="choose-coupons-footer-content">
			<div class="ccfc-left"><span>查看已选</span><i></i></div>
			<div class="ccfc-right"><button>确认使用</button></div>
		</div>
	</footer>
	<div class="mask"></div>
	<div class="coupon-rule">
		<div class="close" v-on:click="clickClose">
			<img src="images/close.png" alt="">
		</div>
		<h3><span>优惠券使用规则</span><em></em></h3>
		<h4>1.优惠券使用类型</h4>
		<p>每个订单仅限使用一种类型优惠券，比如使用免房券则不能再选择满减券，使用其他类型优惠券则可先取消免房券再选择。</p>
		<h4>2.优惠券选择数量</h4>
		<p>每天优惠券可选择数量等于预订间数，比如预订了3间，则每天可使用优惠券数量为3。</p>
		<h4>3.优惠券选择条件说明：</h4>
		<p>比如订单1000元，如果使用满500减10元，则剩余可优惠券金额=1000-500=500元，再使用满200减10元的券，则剩余可优惠金额=500-200=300元，以此计算。</p>
	</div>
	<div class="coupon-mask">
		<div class="close" v-on:click="clickClose">
			<img src="images/close.png" alt="">
		</div>
		<h3><span>已选优惠券</span><em></em></h3>
		<!-- 已选优惠券-空数据 begin -->
		<!-- <div class="empty-img"><img src="images/select_coupon_white_icon.png" alt=""></div>
		<p class="empty-p">您还没有选择优惠券哦！</p> -->
		<!-- 已选优惠券-空数据 end -->
		<div class="list">
			<div class="item">
				<div class="left">
					<div class="price"><i><img src="images/select_coupon_white_icon.png" alt=""></i></div>
				</div>
				<div class="right">
					<h3>20元优惠券<span>（全国酒店通用）</span></h3>
					<time>有效期：2017-07-30 至2017-09-30 </time>
				</div>
				<div class="select"><i><img src="images/coupon_close.png" alt=""></i></div>
				<div class="cose-valut" style="display:none;">20</div>
			</div>
			<div class="item">
				<div class="left">
					<div class="price"><i><img src="images/select_coupon_white_icon.png" alt=""></i></div>
				</div>
				<div class="right">
					<h3>20元优惠券<span>（全国酒店通用）</span></h3>
					<time>有效期：2017-07-30 至2017-09-30 </time>
				</div>
				<div class="select"><i><img src="images/coupon_close.png" alt=""></i></div>
				<div class="cose-valut" style="display:none;">20</div>
			</div>
			<div class="item">
				<div class="left">
					<div class="price"><i><img src="images/select_coupon_white_icon.png" alt=""></i></div>
				</div>
				<div class="right">
					<h3>20元优惠券<span>（全国酒店通用）</span></h3>
					<time>有效期：2017-07-30 至2017-09-30 </time>
				</div>
				<div class="select"><i><img src="images/coupon_close.png" alt=""></i></div>
				<div class="cose-valut" style="display:none;">20</div>
			</div>
		</div>
		<p>温馨提示：点击可取消已选中优惠券</p>
	</div>
</div>
<!-- scripts begin -->
<script src="scripts/jquery-3.1.1.min.js"></script>
<script>
function height100(){
	$(".choose-coupons-wrapper").css({
		'height': '100%'
	});
}
function heightAuto(){
	$(".choose-coupons-wrapper").css({
		'height':'auto'
	});
}
$(function(){
	//温馨提示
	$(".clickPrompt").on("click",function(){
		$(".mask").addClass("maskActive");
		$(".coupon-rule").addClass("couponRuleActive");
		height100();
	});
	$(".coupon-rule .close").on("click",function(){
		$(".mask").removeClass("maskActive");
		$(".coupon-rule").removeClass("couponRuleActive");
		heightAuto();
	});
	//查看已选
	$(".ccfc-left").on("click",function(){
		$(".mask").addClass("maskActive");
		$(".coupon-mask").addClass("couponMaskActive");
		height100();  
	});
	$(".coupon-mask .close").on("click",function(){
		$(".mask").removeClass("maskActive");
		$(".coupon-mask").removeClass("couponMaskActive");
		heightAuto();
	});
	//点击覆盖层
	$(".mask").on("click",function(){
		$(".mask").removeClass("maskActive");
		$(".coupon-rule").removeClass("couponRuleActive");
		$(".coupon-mask").removeClass("couponMaskActive");
		heightAuto();
	});

	$.ajax({
	    url: 'http://10.44.61.27/activity/choose_coupons/data/CouponList.json',
	    type: 'GET',
	    dataType: 'json',
	    data: {},
	    success: function(data){
	    	console.log(data);
	    	//调用data日期列表
	        var hotelListBox = $(".date-list ul");
	        var htmlArray="";
	        var weekArr=['周一','周二','周三','周四','周五','周六','周日'];
			if(data.PricesRp != null && data.PricesRp.length > 0){
			 	for(var i=0;data.PricesRp.length>i;i++){
			 		var discount=data.PricesRp[i].RackFee-data.PricesRp[i].RoomFee;
			 		var weeks=weekArr[new Date(data.PricesRp[i].BizDay).getDay()];
	        		htmlArray+='<li data-id="'+i+'">';
		        	htmlArray+='<p class="date">'+data.PricesRp[i].BizDay.slice(5,-8)+'('+weeks+')'+'</p>';
		        	htmlArray+='<p class="untapped">未使用</p>';
		        	htmlArray+='<em></em>';
		        	htmlArray+='</li>';
		        }
			}
	        hotelListBox.append(htmlArray);

	        //修改DOM样式
	        var wrapperPaddingTop=($(".choose-coupons-header").height())+$(".date-list").outerHeight();
			var wrapperPaddingBottom=$(".choose-coupons-footer").height();
			$(".choose-coupons-wrapper").css({
				'padding-top':wrapperPaddingTop,
				'padding-bottom':wrapperPaddingBottom
			});
			$(".date-list ul").css('width',5*$(".date-list ul li").length+'rem');

			//点击data日期列表
			$(".date-list ul li").eq(0).addClass("active");
			$(".date-list ul li").on("click",function(){
				$(this).addClass("active").siblings().removeClass("active");
				$(".coupon-list .on").hide();
			});

			//调用data优惠券列表
			var hotelItems=$(".coupon-list");
			var htmlItems="";
			if(data.CouponRp.Coupons != null && data.CouponRp.Coupons.length > 0){
			 	for(var i=0;data.CouponRp.Coupons.length>i;i++){
	        		htmlItems+='<div class="item">';
		        	htmlItems+='<div class="left"><div class="price"><i><img src="images/select_coupon_white_icon.png" alt=""></i></div></div>';
		        	htmlItems+='<div class="right">';
		        	htmlItems+='<h3>'+data.CouponRp.Coupons[i].Name+'<span>（'+data.CouponRp.Coupons[i].EnableHotels+'）</span></h3>';
		        	htmlItems+='<time>有效期：'+data.CouponRp.Coupons[i].StartTime.replace(/00:00:00/, "")+'至'+data.CouponRp.Coupons[i].EndTime.replace(/00:00:00/, "")+'</time>';
		        	htmlItems+='</div>';
		        	htmlItems+='<div class="select"><i><img src="images/no_select_icon.png" alt=""></i></div>';
		        	htmlItems+='<div class="cose-valut" style="display:none;">'+data.CouponRp.Coupons[i].CostValue+'</div>'
		        	htmlItems+='</div>';
		        }
			}
			hotelItems.append(htmlItems);

			//选择优惠券列表
			var sum=0;
			$(".coupon-list .item .select").on("click",function(){
				$(this).parent().each(function(index, element){
					sum +=parseInt($(this).next().text());
				});
				$(this).parent().toggleClass("on");
				if($(this).parent().hasClass("on")){
					$(this).find("img").attr("src","images/select_icon.png");
					$(".date-list ul .active .untapped").text("优惠-"+sum+"元");
				}else{
					$(this).find("img").attr("src","images/no_select_icon.png");
				}

			});
	    },
	    error: function(){
	        console.log('error')
	    }
	 })
});
</script>
<!-- scripts end -->
</body>
</html>